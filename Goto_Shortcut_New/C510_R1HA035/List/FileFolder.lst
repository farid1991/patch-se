##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    01/Nov/2019  02:23:02 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  E:\SE\Port\elf2vkp\Goto_Shortcut_New\FileFolder.c    #
#    Command line    =  E:\SE\Port\elf2vkp\Goto_Shortcut_New\FileFolder.c    #
#                       -D NDEBUG -D A2 -D DB3210 -D C510_R1HA035            #
#                       --preprocess=cl E:\SE\Port\elf2vkp\Goto_Shortcut_New #
#                       \C510_R1HA035\List\ -lC E:\SE\Port\elf2vkp\Goto_Shor #
#                       tcut_New\C510_R1HA035\List\ -lA                      #
#                       E:\SE\Port\elf2vkp\Goto_Shortcut_New\C510_R1HA035\Li #
#                       st\ -o E:\SE\Port\elf2vkp\Goto_Shortcut_New\C510_R1H #
#                       A035\Obj\ -z9 --debug --cpu_mode thumb --endian      #
#                       little --cpu ARM926EJ-S --stack_align 4 --interwork  #
#                       -e --enable_multibytes --fpu None --eec++            #
#                       --preinclude E:\SE\Port\elf2vkp\Goto_Shortcut_New\Ta #
#                       rget\C510_R1HA035.h -I "E:\SE\Embedded Workbench     #
#                       4.0 Evaluation\ARM\INC\" --inline_threshold=2        #
#    List file       =  E:\SE\Port\elf2vkp\Goto_Shortcut_New\C510_R1HA035\Li #
#                       st\FileFolder.lst                                    #
#    Object file     =  E:\SE\Port\elf2vkp\Goto_Shortcut_New\C510_R1HA035\Ob #
#                       j\FileFolder.r79                                     #
#                                                                            #
#                                                                            #
##############################################################################

E:\SE\Port\elf2vkp\Goto_Shortcut_New\FileFolder.c
      1          #include "..\\include\Types.h"
      2          #include "..\\include\Function.h"
      3          
      4          #include "main.h"
      5          #include "editor.h"
      6          #include "strlib.h"
      7          #include "FileFolder.h"

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant L"\\x2f\\x25\\x6c\\x73">`:
   \   00000000   2F0025006C00       DC8 2FH, 0, 25H, 0, 6CH, 0, 73H, 0
   \              7300        
   \   00000008   0000               DC8 0, 0
   \   0000000A   0000               DC8 0, 0
   \   0000000C   2E002E000000       DC8 2EH, 0, 2EH, 0, 0, 0
   \   00000012   0000               DC8 0, 0
      8          

   \                                 In segment CODE, align 4, keep-with-next
      9          F_DATA* CreateFData()
     10          {
   \                     ??CreateFData:
   \   00000000   10B5               PUSH     {R4,LR}
     11            F_DATA* fdata = (F_DATA*)malloc(sizeof(F_DATA));
   \   00000002   0420               MOVS     R0,#+4
   \   00000004   ........           _BLF     ??malloc,??malloc??rT
   \   00000008   0400               MOVS     R4,R0
     12            memset(fdata, NULL, sizeof(F_DATA));
   \   0000000A   0422               MOVS     R2,#+4
   \   0000000C   0021               MOVS     R1,#+0
   \   0000000E   ........           _BLF     memset,??memset??rT
     13            set_envp(NULL, EMP_NAME, (OSADDRESS)fdata);
   \   00000012   ....               LDR      R1,??DataTable2  ;; `?<Constant "FList">`
   \   00000014   2200               MOVS     R2,R4
   \   00000016   0020               MOVS     R0,#+0
   \   00000018   ........           _BLF     set_envp,??set_envp??rT
     14            return fdata;
   \   0000001C   2000               MOVS     R0,R4
   \   0000001E   10BD               POP      {R4,PC}          ;; return
     15          }
     16          

   \                                 In segment CODE, align 4, keep-with-next
     17          F_DATA* GetFData()
     18          {
     19            F_DATA* fdata = (F_DATA*)get_envp(NULL, EMP_NAME);
   \                     ??GetFData:
   \   00000000   ....               LDR      R1,??DataTable2  ;; `?<Constant "FList">`
   \   00000002   00B5               PUSH     {LR}
   \   00000004   0020               MOVS     R0,#+0
   \   00000006   ........           _BLF     get_envp,??get_envp??rT
     20            if (fdata) return fdata;
   \   0000000A   0028               CMP      R0,#+0
   \   0000000C   01D1               BNE      ??GetFData_1
     21            return CreateFData();
   \   0000000E   ........           BL       ??CreateFData
   \                     ??GetFData_1:
   \   00000012   00BD               POP      {PC}             ;; return
     22          }
     23          

   \                                 In segment CODE, align 4, keep-with-next
     24          void DeleteFData()
     25          {
   \                     ??DeleteFData:
   \   00000000   10B5               PUSH     {R4,LR}
     26            F_DATA* fdata = (F_DATA*)get_envp(NULL, EMP_NAME);
   \   00000002   ....               LDR      R4,??DataTable2  ;; `?<Constant "FList">`
   \   00000004   0020               MOVS     R0,#+0
   \   00000006   2100               MOVS     R1,R4
   \   00000008   ........           _BLF     get_envp,??get_envp??rT
     27            if (fdata)
   \   0000000C   0028               CMP      R0,#+0
   \   0000000E   06D0               BEQ      ??DeleteFData_1
     28            {
     29              mfree(fdata);
   \   00000010   ........           _BLF     ??mfree,??mfree??rT
     30              set_envp(NULL, EMP_NAME, OSADDRESS(NULL));
   \   00000014   0022               MOVS     R2,#+0
   \   00000016   2100               MOVS     R1,R4
   \   00000018   0020               MOVS     R0,#+0
   \   0000001A   ........           _BLF     set_envp,??set_envp??rT
     31            }
     32          }
   \                     ??DeleteFData_1:
   \   0000001E   10BD               POP      {R4,PC}          ;; return
     33          

   \                                 In segment CODE, align 4, keep-with-next
     34          void Free_FLIST( void )
     35          {
   \                     ??Free_FLIST:
   \   00000000   70B5               PUSH     {R4-R6,LR}
     36            F_DATA* fdata = GetFData();
   \   00000002   ........           BL       ??GetFData
     37            FLIST* fl = (FLIST*) fdata->fltop;
   \   00000006   0468               LDR      R4,[R0, #+0]
     38            fdata->fltop = NULL;
   \   00000008   0021               MOVS     R1,#+0
   \   0000000A   0160               STR      R1,[R0, #+0]
   \   0000000C   0CE0               B        ??Free_FLIST_1
     39            
     40            while( fl )
     41            {
     42              FLIST* fl_prev = fl;
   \                     ??Free_FLIST_2:
   \   0000000E   2500               MOVS     R5,R4
     43              StringFree( fl_prev->fullname );
   \   00000010   2E00               MOVS     R6,R5
   \   00000012   0836               ADDS     R6,R6,#+8
   \   00000014   3068               LDR      R0,[R6, #+0]
   \   00000016   ........           _BLF     ??StringFree,??StringFree??rT
     44              StringFree( fl_prev->name );
   \   0000001A   7068               LDR      R0,[R6, #+4]
   \   0000001C   ........           _BLF     ??StringFree,??StringFree??rT
     45              fl = (FLIST*) fl->next;
   \   00000020   2468               LDR      R4,[R4, #+0]
     46              mfree( fl_prev);
   \   00000022   2800               MOVS     R0,R5
   \   00000024   ........           _BLF     ??mfree,??mfree??rT
     47            }
   \                     ??Free_FLIST_1:
   \   00000028   002C               CMP      R4,#+0
   \   0000002A   F0D1               BNE      ??Free_FLIST_2
     48          }
   \   0000002C   70BD               POP      {R4-R6,PC}       ;; return
     49          

   \                                 In segment CODE, align 4, keep-with-next
     50          FLIST* AddToFList( const wchar_t* full_name, const wchar_t* name, int is_folder )
     51          {
   \                     ??AddToFList:
   \   00000000   F4B5               PUSH     {R2,R4-R7,LR}
   \   00000002   0400               MOVS     R4,R0
   \   00000004   0D00               MOVS     R5,R1
     52            // int l_fname;
     53            F_DATA* fdata = GetFData();
   \   00000006   ........           BL       ??GetFData
   \   0000000A   0600               MOVS     R6,R0
     54            
     55            FLIST* fl;
     56            FLIST* fn = (FLIST*)malloc(sizeof(FLIST));
   \   0000000C   1020               MOVS     R0,#+16
   \   0000000E   ........           _BLF     ??malloc,??malloc??rT
   \   00000012   0700               MOVS     R7,R0
     57            
     58            fn->fullname = StringAlloc(wstrlen( full_name ));
   \   00000014   2000               MOVS     R0,R4
   \   00000016   ........           _BLF     wstrlen,??wstrlen??rT
   \   0000001A   ........           _BLF     ??StringAlloc,??StringAlloc??rT
   \   0000001E   B860               STR      R0,[R7, #+8]
     59            
     60            fn->name = StringAlloc(wstrlen( name ));
   \   00000020   2800               MOVS     R0,R5
   \   00000022   ........           _BLF     wstrlen,??wstrlen??rT
   \   00000026   ........           _BLF     ??StringAlloc,??StringAlloc??rT
   \   0000002A   F860               STR      R0,[R7, #+12]
     61            
     62            wstrcpy( fn->fullname, full_name );
   \   0000002C   B868               LDR      R0,[R7, #+8]
   \   0000002E   2100               MOVS     R1,R4
   \   00000030   ........           _BLF     wstrcpy,??wstrcpy??rT
     63            wstrcpy( fn->name, name );
   \   00000034   F868               LDR      R0,[R7, #+12]
   \   00000036   2900               MOVS     R1,R5
   \   00000038   ........           _BLF     wstrcpy,??wstrcpy??rT
     64            fn->is_folder = is_folder;
   \   0000003C   0098               LDR      R0,[SP, #+0]
   \   0000003E   7860               STR      R0,[R7, #+4]
     65            fn->next = 0;
   \   00000040   0020               MOVS     R0,#+0
   \   00000042   3860               STR      R0,[R7, #+0]
     66            fl = (FLIST*) fdata->fltop;
   \   00000044   3468               LDR      R4,[R6, #+0]
     67            if ( fl )
   \   00000046   002C               CMP      R4,#+0
   \   00000048   0AD0               BEQ      ??AddToFList_1
     68            {
     69              FLIST* pr;
     70              pr = (FLIST*) &fdata->fltop;
     71              while( wstrcmpi( fl->name, fn->name ) < 0 )
   \                     ??AddToFList_2:
   \   0000004A   E068               LDR      R0,[R4, #+12]
   \   0000004C   F968               LDR      R1,[R7, #+12]
   \   0000004E   ........           _BLF     wstrcmpi,??wstrcmpi??rT
   \   00000052   0028               CMP      R0,#+0
   \   00000054   03D5               BPL      ??AddToFList_3
     72              {
     73                pr = fl;
   \   00000056   2600               MOVS     R6,R4
     74                fl = (FLIST*) fl->next;
   \   00000058   2468               LDR      R4,[R4, #+0]
     75                
     76                if ( !fl )
   \   0000005A   002C               CMP      R4,#+0
   \   0000005C   F5D1               BNE      ??AddToFList_2
     77                  break;
     78              }
     79              fn->next = fl;
   \                     ??AddToFList_3:
   \   0000005E   3C60               STR      R4,[R7, #+0]
     80              pr->next = fn;
     81            }
     82            else
     83            {
     84              fdata->fltop = fn;
   \                     ??AddToFList_1:
   \   00000060   3760               STR      R7,[R6, #+0]
     85            }
     86            return fn;
   \   00000062   3800               MOVS     R0,R7
   \   00000064   F8BD               POP      {R3-R7,PC}       ;; return
     87          }
     88          

   \                                 In segment CODE, align 4, keep-with-next
     89          int FindFiles( wchar_t* str, int type ) // type == 0 SelectFolder, type == 1 SelectFile
     90          {
   \                     ??FindFiles:
   \   00000000   F3B5               PUSH     {R0,R1,R4-R7,LR}
   \   00000002   8DB0               SUB      SP,SP,#+52
     91            int i, c, n = 0;
   \   00000004   0024               MOVS     R4,#+0
   \   00000006   0027               MOVS     R7,#+0
     92            Free_FLIST();
   \   00000008   ........           BL       ??Free_FLIST
     93            
     94            wchar_t* path = StringAlloc(255);
   \   0000000C   FF20               MOVS     R0,#+255
   \   0000000E   ........           _BLF     ??StringAlloc,??StringAlloc??rT
   \   00000012   0500               MOVS     R5,R0
     95            wchar_t* name = StringAlloc(63);
   \   00000014   3F20               MOVS     R0,#+63
   \   00000016   ........           _BLF     ??StringAlloc,??StringAlloc??rT
   \   0000001A   0600               MOVS     R6,R0
     96            
     97            wchar_t* rev = NULL, * d = name, * s = str;
   \   0000001C   0094               STR      R4,[SP, #+0]
   \   0000001E   0D99               LDR      R1,[SP, #+52]
   \   00000020   07E0               B        ??FindFiles_1
     98            
     99            while( ( c = *s++ ) )
    100            {
    101              *d = c;
   \                     ??FindFiles_2:
   \   00000022   0280               STRH     R2,[R0, #+0]
    102              if ( c == '/' &&* s!= '\0' ) rev = d;
   \   00000024   2F2A               CMP      R2,#+47
   \   00000026   03D1               BNE      ??FindFiles_3
   \   00000028   0A88               LDRH     R2,[R1, #+0]
   \   0000002A   002A               CMP      R2,#+0
   \   0000002C   00D0               BEQ      ??FindFiles_3
   \   0000002E   0090               STR      R0,[SP, #+0]
    103              d++;
   \                     ??FindFiles_3:
   \   00000030   801C               ADDS     R0,R0,#+2
    104            }
   \                     ??FindFiles_1:
   \   00000032   0A88               LDRH     R2,[R1, #+0]
   \   00000034   891C               ADDS     R1,R1,#+2
   \   00000036   002A               CMP      R2,#+0
   \   00000038   F3D1               BNE      ??FindFiles_2
   \   0000003A   0098               LDR      R0,[SP, #+0]
   \   0000003C   0028               CMP      R0,#+0
   \   0000003E   09D0               BEQ      ??FindFiles_4
    105            if( rev )
    106            {
    107              if ( rev == name ) // ???? ???? ?? ??????
   \   00000040   B042               CMP      R0,R6
   \   00000042   01D1               BNE      ??FindFiles_5
    108                * ( rev + 1 ) = 0;
   \   00000044   4480               STRH     R4,[R0, #+2]
   \   00000046   00E0               B        ??FindFiles_6
    109              else
    110                * rev = 0;
   \                     ??FindFiles_5:
   \   00000048   0480               STRH     R4,[R0, #+0]
    111              AddToFList( name, back, IS_BACK );
   \                     ??FindFiles_6:
   \   0000004A   ....               LDR      R1,??DataTable4  ;; `?<Constant L"\\x2f\\x25\\x6c\\x73">` + 12
   \   0000004C   3000               MOVS     R0,R6
   \   0000004E   ........           BL       ??AddToFList
    112              n++;
   \   00000052   0127               MOVS     R7,#+1
    113            }
    114            void* dir = w_diropen( str );
   \                     ??FindFiles_4:
   \   00000054   0D98               LDR      R0,[SP, #+52]
   \   00000056   ........           _BLF     w_diropen,??w_diropen??rT
   \   0000005A   0290               STR      R0,[SP, #+8]
    115            if ( dir )
   \   0000005C   0028               CMP      R0,#+0
   \   0000005E   39D0               BEQ      ??FindFiles_7
    116            {
    117              wchar_t* next;
    118              w_chdir( str );
   \   00000060   0D98               LDR      R0,[SP, #+52]
   \   00000062   ........           _BLF     w_chdir,??w_chdir??rT
   \   00000066   0BE0               B        ??FindFiles_8
    119              while( ( next = w_dirread( dir ) ) )
    120              {
    121                W_FSTAT fs;
    122                w_fstat( next, &fs );
    123                i = wstrlen( str );
    124                wstrcpy( path, str );
    125                if ( rev )
    126                {
    127                  path[ i++ ] = '/';
    128                }
    129                wstrcpy( path + i, next );
    130                if ( fs.attr&0x4000 )
    131                {
    132                  snwprintf( name, 63, L"/%ls", next );
   \                     ??FindFiles_9:
   \   00000068   019B               LDR      R3,[SP, #+4]
   \   0000006A   1F4A               LDR      R2,??FindFiles_10  ;; `?<Constant L"\\x2f\\x25\\x6c\\x73">`
   \   0000006C   3F21               MOVS     R1,#+63
   \   0000006E   3000               MOVS     R0,R6
   \   00000070   ........           _BLF     snwprintf,??snwprintf??rT
    133                  AddToFList( path, name, IS_FOLDER );
   \   00000074   0122               MOVS     R2,#+1
   \   00000076   3100               MOVS     R1,R6
   \                     ??FindFiles_11:
   \   00000078   2800               MOVS     R0,R5
   \   0000007A   ........           BL       ??AddToFList
    134                  n++;
   \   0000007E   2700               MOVS     R7,R4
    135                }
   \                     ??FindFiles_8:
   \   00000080   0298               LDR      R0,[SP, #+8]
   \   00000082   ........           _BLF     w_dirread,??w_dirread??rT
   \   00000086   0190               STR      R0,[SP, #+4]
   \   00000088   0028               CMP      R0,#+0
   \   0000008A   20D0               BEQ      ??FindFiles_12
   \   0000008C   03A9               ADD      R1,SP,#+12
   \   0000008E   ........           _BLF     w_fstat,??w_fstat??rT
   \   00000092   0D98               LDR      R0,[SP, #+52]
   \   00000094   ........           _BLF     wstrlen,??wstrlen??rT
   \   00000098   0D99               LDR      R1,[SP, #+52]
   \   0000009A   0400               MOVS     R4,R0
   \   0000009C   2800               MOVS     R0,R5
   \   0000009E   ........           _BLF     wstrcpy,??wstrcpy??rT
   \   000000A2   0098               LDR      R0,[SP, #+0]
   \   000000A4   0028               CMP      R0,#+0
   \   000000A6   03D0               BEQ      ??FindFiles_13
   \   000000A8   6000               LSLS     R0,R4,#+1
   \   000000AA   2F21               MOVS     R1,#+47
   \   000000AC   2952               STRH     R1,[R5, R0]
   \   000000AE   641C               ADDS     R4,R4,#+1
   \                     ??FindFiles_13:
   \   000000B0   0199               LDR      R1,[SP, #+4]
   \   000000B2   6000               LSLS     R0,R4,#+1
   \   000000B4   2818               ADDS     R0,R5,R0
   \   000000B6   ........           _BLF     wstrcpy,??wstrcpy??rT
   \   000000BA   0398               LDR      R0,[SP, #+12]
   \   000000BC   7C1C               ADDS     R4,R7,#+1
   \   000000BE   4004               LSLS     R0,R0,#+17
   \   000000C0   D2D4               BMI      ??FindFiles_9
    136                else
    137                {
    138                  if ( type == SFILE )
   \   000000C2   0E98               LDR      R0,[SP, #+56]
   \   000000C4   0128               CMP      R0,#+1
   \   000000C6   DBD1               BNE      ??FindFiles_8
    139                  {
    140                    AddToFList( path, next, IS_FILE );
   \   000000C8   0199               LDR      R1,[SP, #+4]
   \   000000CA   0222               MOVS     R2,#+2
   \   000000CC   D4E7               B.N      ??FindFiles_11
    141                    n++;
    142                  }
    143                }
    144              }
    145              w_dirclose( dir );
   \                     ??FindFiles_12:
   \   000000CE   0298               LDR      R0,[SP, #+8]
   \   000000D0   ........           _BLF     w_dirclose,??w_dirclose??rT
    146            }
    147            StringFree( name );
   \                     ??FindFiles_7:
   \   000000D4   3000               MOVS     R0,R6
   \   000000D6   ........           _BLF     ??StringFree,??StringFree??rT
    148            StringFree( path );
   \   000000DA   2800               MOVS     R0,R5
   \   000000DC   ........           _BLF     ??StringFree,??StringFree??rT
    149            return n;
   \   000000E0   3800               MOVS     R0,R7
   \   000000E2   0FB0               ADD      SP,SP,#+60
   \   000000E4   F0BD               POP      {R4-R7,PC}       ;; return
   \   000000E6   C046               Nop      
   \                     ??FindFiles_10:
   \   000000E8   ........           DC32     `?<Constant L"\\x2f\\x25\\x6c\\x73">`
    150          }
    151          

   \                                 In segment CODE, align 4, keep-with-next
    152          FLIST* FindFLISTtByNS( int* i, int si )
    153          {
   \                     ??FindFLISTtByNS:
   \   00000000   30B5               PUSH     {R4,R5,LR}
   \   00000002   0400               MOVS     R4,R0
   \   00000004   0D00               MOVS     R5,R1
    154            F_DATA* fdata = GetFData();
    155            
    156            FLIST* fl;
    157            fl = (FLIST*) fdata->fltop;
   \   00000006   ........           BL       ??GetFData
   \   0000000A   01E0               B.N      ??FindFLISTtByNS_1
    158            while( fl )
    159            {
    160              if ( fl->is_folder == si )
    161              {
    162                if ( !(*i) )
    163                  return fl;
    164                (*i)--;
   \                     ??FindFLISTtByNS_2:
   \   0000000C   491E               SUBS     R1,R1,#+1
   \   0000000E   2160               STR      R1,[R4, #+0]
    165              }
    166              fl = (FLIST*) fl->next;
   \                     ??FindFLISTtByNS_1:
   \   00000010   0068               LDR      R0,[R0, #+0]
   \   00000012   0028               CMP      R0,#+0
   \   00000014   05D0               BEQ      ??FindFLISTtByNS_3
   \   00000016   4168               LDR      R1,[R0, #+4]
   \   00000018   A942               CMP      R1,R5
   \   0000001A   F9D1               BNE      ??FindFLISTtByNS_1
   \   0000001C   2168               LDR      R1,[R4, #+0]
   \   0000001E   0029               CMP      R1,#+0
   \   00000020   F4D1               BNE      ??FindFLISTtByNS_2
    167            }
    168            return fl;
   \                     ??FindFLISTtByNS_3:
   \   00000022   30BD               POP      {R4,R5,PC}       ;; return
    169          }
    170          

   \                                 In segment CODE, align 4, keep-with-next
    171          FLIST* FindFLISTtByN( int n )
    172          {
   \                     ??FindFLISTtByN:
   \   00000000   01B5               PUSH     {R0,LR}
    173            FLIST* fl;
    174            fl = FindFLISTtByNS( &n, IS_BACK );
   \   00000002   0021               MOVS     R1,#+0
   \   00000004   6846               MOV      R0,SP
   \   00000006   ........           BL       ??FindFLISTtByNS
    175           
    176            if ( !n && fl )
   \   0000000A   0099               LDR      R1,[SP, #+0]
   \   0000000C   0029               CMP      R1,#+0
   \   0000000E   02D1               BNE      ??FindFLISTtByN_1
   \   00000010   0028               CMP      R0,#+0
   \   00000012   00D0               BEQ      ??FindFLISTtByN_1
    177              return fl;
   \                     ??FindFLISTtByN_2:
   \   00000014   08BD               POP      {R3,PC}          ;; return
    178          
    179            fl = FindFLISTtByNS( &n, IS_FOLDER );
   \                     ??FindFLISTtByN_1:
   \   00000016   0121               MOVS     R1,#+1
   \   00000018   6846               MOV      R0,SP
   \   0000001A   ........           BL       ??FindFLISTtByNS
    180            if ( !n && fl )
   \   0000001E   0099               LDR      R1,[SP, #+0]
   \   00000020   0029               CMP      R1,#+0
   \   00000022   01D1               BNE      ??FindFLISTtByN_3
   \   00000024   0028               CMP      R0,#+0
   \   00000026   F5D1               BNE      ??FindFLISTtByN_2
    181              return fl;
    182          
    183            fl = FindFLISTtByNS( &n, IS_FILE );
   \                     ??FindFLISTtByN_3:
   \   00000028   0221               MOVS     R1,#+2
   \   0000002A   6846               MOV      R0,SP
   \   0000002C   ........           BL       ??FindFLISTtByNS
    184            
    185            if ( !n && fl )
   \   00000030   08BD               POP      {R3,PC}
    186              return fl;
    187            
    188            return fl;
    189          }
    190          
    191          

   \                                 In segment CODE, align 4, keep-with-next
    192          int OnMessage( GUI_MESSAGE* msg )
    193          {
   \                     ??OnMessage:
   \   00000000   30B5               PUSH     {R4,R5,LR}
   \   00000002   0400               MOVS     R4,R0
    194            TEXTID str = EMPTY_TEXTID;
    195            FLIST* fl;
    196            switch( GUIonMessage_GetMsg( msg ) )
   \   00000004   ........           _BLF     GUIonMessage_GetMsg,??GUIonMessage_GetMsg??rT
   \   00000008   0128               CMP      R0,#+1
   \   0000000A   1AD1               BNE      ??OnMessage_1
    197            {
    198            case LISTMSG_GetItem:
    199              int index = GUIonMessage_GetCreatedItemIndex( msg );
   \   0000000C   2000               MOVS     R0,R4
   \   0000000E   ........           _BLF     GUIonMessage_GetCreatedItemIndex,??GUIonMessage_GetCreatedItemIndex??rT
    200              fl = FindFLISTtByN( index );
   \   00000012   ........           BL       ??FindFLISTtByN
   \   00000016   0500               MOVS     R5,R0
    201              str = TextID_Get( fl->name );
   \   00000018   E868               LDR      R0,[R5, #+12]
   \   0000001A   FF22               MOVS     R2,#+255
   \   0000001C   0021               MOVS     R1,#+0
   \   0000001E   ........           _BLF     TextID_Create,??TextID_Create??rT
   \   00000022   0100               MOVS     R1,R0
    202              GUIonMessage_SetMenuItemText( msg, str );
   \   00000024   2000               MOVS     R0,R4
   \   00000026   ........           _BLF     GUIonMessage_SetMenuItemText,??GUIonMessage_SetMenuItemText??rT
    203              
    204              if(wstrcmp(fl->name,back))
   \   0000002A   E868               LDR      R0,[R5, #+12]
   \   0000002C   ....               LDR      R1,??DataTable4  ;; `?<Constant L"\\x2f\\x25\\x6c\\x73">` + 12
   \   0000002E   ........           _BLF     wstrcmp,??wstrcmp??rT
   \   00000032   0028               CMP      R0,#+0
   \   00000034   05D0               BEQ      ??OnMessage_1
    205                GUIonMessage_SetMenuItemIcon(msg, 0, TypesIcons[TYPE_FOLDER]);
   \   00000036   B522               MOVS     R2,#+181
   \   00000038   5200               LSLS     R2,R2,#+1
   \   0000003A   0021               MOVS     R1,#+0
   \   0000003C   2000               MOVS     R0,R4
   \   0000003E   ........           _BLF     GUIonMessage_SetMenuItemIcon,??GUIonMessage_SetMenuItemIcon??rT
    206          
    207              break;
    208            }
    209            return 1;
   \                     ??OnMessage_1:
   \   00000042   0120               MOVS     R0,#+1
   \   00000044   30BD               POP      {R4,R5,PC}       ;; return
    210          };
    211          

   \                                 In segment CODE, align 4, keep-with-next
    212          void Self_OnBack( BOOK* book, GUI* gui )
    213          {
   \                     ??Self_OnBack:
   \   00000000   10B5               PUSH     {R4,LR}
   \   00000002   0400               MOVS     R4,R0
    214            GotoShortcut_Book* mbk = (GotoShortcut_Book*)book;
    215            FREE_FLGUI( mbk->SelectFolder );
   \   00000004   ........           BL       ??Free_FLIST
   \   00000008   A06B               LDR      R0,[R4, #+56]
   \   0000000A   0028               CMP      R0,#+0
   \   0000000C   03D0               BEQ      ??Self_OnBack_1
   \   0000000E   ........           _BLF     GUIObject_Destroy,??GUIObject_Destroy??rT
   \   00000012   0020               MOVS     R0,#+0
   \   00000014   A063               STR      R0,[R4, #+56]
    216            DeleteFData();
   \                     ??Self_OnBack_1:
   \   00000016   ........           BL       ??DeleteFData
    217          }
   \   0000001A   10BD               POP      {R4,PC}          ;; return
    218          

   \                                 In segment CODE, align 4, keep-with-next
    219          void Self_onEnterPressed( BOOK* book, GUI* )
    220          {
   \                     ??Self_onEnterPressed:
   \   00000000   F0B5               PUSH     {R4-R7,LR}
   \   00000002   0500               MOVS     R5,R0
    221            GotoShortcut_Book* mbk = (GotoShortcut_Book*)book;
    222            int item = ListMenu_GetSelectedItem( mbk->SelectFolder );
   \   00000004   A86B               LDR      R0,[R5, #+56]
   \   00000006   ........           _BLF     ListMenu_GetSelectedItem,??ListMenu_GetSelectedItem??rT
    223            FLIST* fl = FindFLISTtByN( item );
   \   0000000A   ........           BL       ??FindFLISTtByN
   \   0000000E   0700               MOVS     R7,R0
    224            if ( fl )
   \   00000010   35D0               BEQ      ??Self_onEnterPressed_1
    225            {
    226              wchar_t* path = StringAlloc(255);
   \   00000012   FF20               MOVS     R0,#+255
   \   00000014   ........           _BLF     ??StringAlloc,??StringAlloc??rT
   \   00000018   0400               MOVS     R4,R0
    227              if ( fl->is_folder == IS_FOLDER || fl->is_folder == IS_BACK )
   \   0000001A   7868               LDR      R0,[R7, #+4]
   \   0000001C   0026               MOVS     R6,#+0
   \   0000001E   0128               CMP      R0,#+1
   \   00000020   01D0               BEQ      ??Self_onEnterPressed_2
   \   00000022   0028               CMP      R0,#+0
   \   00000024   12D1               BNE      ??Self_onEnterPressed_3
    228              {
    229                wstrncpy( path, fl->fullname, 255 );
   \                     ??Self_onEnterPressed_2:
   \   00000026   B968               LDR      R1,[R7, #+8]
   \   00000028   FF22               MOVS     R2,#+255
   \   0000002A   2000               MOVS     R0,R4
   \   0000002C   ........           _BLF     wstrncpy,??wstrncpy??rT
    230                FREE_FLGUI( mbk->SelectFolder );
   \   00000030   ........           BL       ??Free_FLIST
   \   00000034   A86B               LDR      R0,[R5, #+56]
   \   00000036   0028               CMP      R0,#+0
   \   00000038   02D0               BEQ      ??Self_onEnterPressed_4
   \   0000003A   ........           _BLF     GUIObject_Destroy,??GUIObject_Destroy??rT
   \   0000003E   AE63               STR      R6,[R5, #+56]
    231                mbk->SelectFolder = CreateFileFolderSelect( mbk, path );
   \                     ??Self_onEnterPressed_4:
   \   00000040   2100               MOVS     R1,R4
   \   00000042   2800               MOVS     R0,R5
   \   00000044   ........           BL       ??CreateFileFolderSelect
   \   00000048   A863               STR      R0,[R5, #+56]
   \   0000004A   15E0               B        ??Self_onEnterPressed_5
    232              }
    233              else
    234              {
    235                TEXTID str = TextID_Get( fl->fullname );
   \                     ??Self_onEnterPressed_3:
   \   0000004C   B868               LDR      R0,[R7, #+8]
   \   0000004E   FF22               MOVS     R2,#+255
   \   00000050   0021               MOVS     R1,#+0
   \   00000052   ........           _BLF     TextID_Create,??TextID_Create??rT
   \   00000056   0700               MOVS     R7,R0
    236                StringInput_DispObject_SetText( GUIObject_GetDispObject( mbk->FolderInput ), str );
   \   00000058   686B               LDR      R0,[R5, #+52]
   \   0000005A   ........           _BLF     GUIObject_GetDispObject,??GUIObject_GetDispObject??rT
   \   0000005E   3900               MOVS     R1,R7
   \   00000060   ........           _BLF     StringInput_DispObject_SetText,??StringInput_DispObject_SetText??rT
    237                FREE_FLGUI( mbk->SelectFolder );
   \   00000064   ........           BL       ??Free_FLIST
   \   00000068   A86B               LDR      R0,[R5, #+56]
   \   0000006A   0028               CMP      R0,#+0
   \   0000006C   02D0               BEQ      ??Self_onEnterPressed_6
   \   0000006E   ........           _BLF     GUIObject_Destroy,??GUIObject_Destroy??rT
   \   00000072   AE63               STR      R6,[R5, #+56]
    238                DeleteFData();
   \                     ??Self_onEnterPressed_6:
   \   00000074   ........           BL       ??DeleteFData
    239              }
    240              StringFree( path );
   \                     ??Self_onEnterPressed_5:
   \   00000078   2000               MOVS     R0,R4
   \   0000007A   ........           _BLF     ??StringFree,??StringFree??rT
    241            }
    242          }
   \                     ??Self_onEnterPressed_1:
   \   0000007E   F0BD               POP      {R4-R7,PC}       ;; return
    243          

   \                                 In segment CODE, align 4, keep-with-next
    244          void Self_onSelectPressed( BOOK* book, GUI* gui )
    245          {
   \                     ??Self_onSelectPressed:
   \   00000000   30B5               PUSH     {R4,R5,LR}
   \   00000002   0400               MOVS     R4,R0
    246            GotoShortcut_Book* mbk = (GotoShortcut_Book*)book;
    247            int item = ListMenu_GetSelectedItem( mbk->SelectFolder );
   \   00000004   3434               ADDS     R4,R4,#+52
   \   00000006   6068               LDR      R0,[R4, #+4]
   \   00000008   ........           _BLF     ListMenu_GetSelectedItem,??ListMenu_GetSelectedItem??rT
    248            
    249            FLIST* fl = FindFLISTtByN( item );
   \   0000000C   ........           BL       ??FindFLISTtByN
    250            if ( fl )
   \   00000010   0028               CMP      R0,#+0
   \   00000012   1FD0               BEQ      ??Self_onSelectPressed_1
    251            {
    252              if ( ( fl->is_folder == IS_FOLDER && mbk->FType == SFOLDER ) || fl->is_folder == IS_FILE )
   \   00000014   4168               LDR      R1,[R0, #+4]
   \   00000016   0129               CMP      R1,#+1
   \   00000018   03D1               BNE      ??Self_onSelectPressed_2
   \   0000001A   617C               LDRB     R1,[R4, #+17]
   \   0000001C   0029               CMP      R1,#+0
   \   0000001E   19D1               BNE      ??Self_onSelectPressed_1
   \   00000020   01E0               B        ??Self_onSelectPressed_3
   \                     ??Self_onSelectPressed_2:
   \   00000022   0229               CMP      R1,#+2
   \   00000024   16D1               BNE      ??Self_onSelectPressed_1
    253              {
    254                TEXTID str = TextID_Get( fl->fullname );
   \                     ??Self_onSelectPressed_3:
   \   00000026   8068               LDR      R0,[R0, #+8]
   \   00000028   FF22               MOVS     R2,#+255
   \   0000002A   0021               MOVS     R1,#+0
   \   0000002C   ........           _BLF     TextID_Create,??TextID_Create??rT
   \   00000030   0500               MOVS     R5,R0
    255                StringInput_DispObject_SetText( GUIObject_GetDispObject( mbk->FolderInput ), str );
   \   00000032   2068               LDR      R0,[R4, #+0]
   \   00000034   ........           _BLF     GUIObject_GetDispObject,??GUIObject_GetDispObject??rT
   \   00000038   2900               MOVS     R1,R5
   \   0000003A   ........           _BLF     StringInput_DispObject_SetText,??StringInput_DispObject_SetText??rT
    256                FREE_FLGUI( mbk->SelectFolder );
   \   0000003E   ........           BL       ??Free_FLIST
   \   00000042   6068               LDR      R0,[R4, #+4]
   \   00000044   0028               CMP      R0,#+0
   \   00000046   03D0               BEQ      ??Self_onSelectPressed_4
   \   00000048   ........           _BLF     GUIObject_Destroy,??GUIObject_Destroy??rT
   \   0000004C   0020               MOVS     R0,#+0
   \   0000004E   6060               STR      R0,[R4, #+4]
    257                DeleteFData();
   \                     ??Self_onSelectPressed_4:
   \   00000050   ........           BL       ??DeleteFData
    258              }
    259            }
    260          }
   \                     ??Self_onSelectPressed_1:
   \   00000054   30BD               POP      {R4,R5,PC}       ;; return
    261          

   \                                 In segment CODE, align 4, keep-with-next
    262          int isdir( wchar_t* name )
    263          {
   \                     ??isdir:
   \   00000000   00B5               PUSH     {LR}
   \   00000002   8AB0               SUB      SP,SP,#+40
    264            W_FSTAT fs;
    265            if ( w_fstat( name, &fs )!= - 1 )
   \   00000004   6946               MOV      R1,SP
   \   00000006   ........           _BLF     w_fstat,??w_fstat??rT
   \   0000000A   0021               MOVS     R1,#+0
   \   0000000C   C943               MVNS     R1,R1
   \   0000000E   8842               CMP      R0,R1
   \   00000010   04D0               BEQ      ??isdir_1
    266              return fs.attr&0x4000;
   \   00000012   0099               LDR      R1,[SP, #+0]
   \   00000014   8020               MOVS     R0,#+128
   \   00000016   C001               LSLS     R0,R0,#+7
   \   00000018   0840               ANDS     R0,R0,R1
   \   0000001A   00E0               B        ??isdir_2
    267            else return 0;
   \                     ??isdir_1:
   \   0000001C   0020               MOVS     R0,#+0
   \                     ??isdir_2:
   \   0000001E   0AB0               ADD      SP,SP,#+40
   \   00000020   00BD               POP      {PC}             ;; return
    268          }
    269          

   \                                 In segment CODE, align 4, keep-with-next
    270          GUI_LIST* CreateFileFolderSelect( BOOK* book, wchar_t* str )
    271          {
   \                     ??CreateFileFolderSelect:
   \   00000000   F0B5               PUSH     {R4-R7,LR}
   \   00000002   0400               MOVS     R4,R0
   \   00000004   0E00               MOVS     R6,R1
    272            GotoShortcut_Book* mbk = (GotoShortcut_Book*)book;
    273            
    274            wchar_t* ustr = StringAlloc(255);
   \   00000006   FF20               MOVS     R0,#+255
   \   00000008   ........           _BLF     ??StringAlloc,??StringAlloc??rT
   \   0000000C   0500               MOVS     R5,R0
    275            wchar_t* s;
    276            GUI_LIST* f_list_gui;
    277            int n;
    278            
    279            wstrcpy( ustr, str );
   \   0000000E   3100               MOVS     R1,R6
   \   00000010   ........           _BLF     wstrcpy,??wstrcpy??rT
    280            str = ustr;
   \   00000014   2E00               MOVS     R6,R5
    281            
    282            int f = 0;
   \   00000016   01E0               B        ??CreateFileFolderSelect_1
    283            do 
    284            {
    285              if ( isdir( ustr ) )
    286              {
    287                f = 1;
    288                break;
    289              }
    290              s = wstrrchr( ustr, L'/' );
    291          
    292              if ( s == ustr )
    293                break;
    294          
    295              if ( s )
    296                *s = 0;
   \                     ??CreateFileFolderSelect_2:
   \   00000018   0021               MOVS     R1,#+0
   \   0000001A   0180               STRH     R1,[R0, #+0]
   \                     ??CreateFileFolderSelect_1:
   \   0000001C   2800               MOVS     R0,R5
   \   0000001E   ........           BL       ??isdir
   \   00000022   0028               CMP      R0,#+0
   \   00000024   08D1               BNE      ??CreateFileFolderSelect_3
   \   00000026   2F21               MOVS     R1,#+47
   \   00000028   2800               MOVS     R0,R5
   \   0000002A   ........           _BLF     wstrrchr,??wstrrchr??rT
   \   0000002E   A842               CMP      R0,R5
   \   00000030   01D0               BEQ      ??CreateFileFolderSelect_4
   \   00000032   0028               CMP      R0,#+0
   \   00000034   F0D1               BNE      ??CreateFileFolderSelect_2
    297            }while( s );
    298          
    299            if ( !f )
    300              str = L"/";
   \                     ??CreateFileFolderSelect_4:
   \   00000036   1DA6               ADR      R6,??CreateFileFolderSelect_5  ;; 0x2F, 0x00, 0x00, 0x00
    301            
    302            n = FindFiles( str, mbk->FType );
   \                     ??CreateFileFolderSelect_3:
   \   00000038   4520               MOVS     R0,#+69
   \   0000003A   215C               LDRB     R1,[R4, R0]
   \   0000003C   3000               MOVS     R0,R6
   \   0000003E   ........           BL       ??FindFiles
   \   00000042   0700               MOVS     R7,R0
    303            
    304            f_list_gui = CreateListMenu( mbk, UIDisplay_Main );
   \   00000044   0021               MOVS     R1,#+0
   \   00000046   2000               MOVS     R0,R4
   \   00000048   ........           _BLF     CreateListMenu,??CreateListMenu??rT
   \   0000004C   0400               MOVS     R4,R0
    305            GUIObject_SetTitleText( f_list_gui, TextID_Get(str) ); //SELECT_FOLDER_TXT );
   \   0000004E   FF22               MOVS     R2,#+255
   \   00000050   0021               MOVS     R1,#+0
   \   00000052   3000               MOVS     R0,R6
   \   00000054   ........           _BLF     TextID_Create,??TextID_Create??rT
   \   00000058   0100               MOVS     R1,R0
   \   0000005A   2000               MOVS     R0,R4
   \   0000005C   ........           _BLF     GUIObject_SetTitleText,??GUIObject_SetTitleText??rT
    306            ListMenu_SetItemCount( f_list_gui, n );
   \   00000060   3900               MOVS     R1,R7
   \   00000062   2000               MOVS     R0,R4
   \   00000064   ........           _BLF     ListMenu_SetItemCount,??ListMenu_SetItemCount??rT
    307            ListMenu_SetCursorToItem( f_list_gui, 0 );
   \   00000068   0021               MOVS     R1,#+0
   \   0000006A   2000               MOVS     R0,R4
   \   0000006C   ........           _BLF     ListMenu_SetCursorToItem,??ListMenu_SetCursorToItem??rT
    308            ListMenu_SetOnMessage( f_list_gui, OnMessage );
   \   00000070   0F49               LDR      R1,??CreateFileFolderSelect_5+0x4  ;; ??OnMessage
   \   00000072   2000               MOVS     R0,R4
   \   00000074   ........           _BLF     ListMenu_SetOnMessage,??ListMenu_SetOnMessage??rT
    309            GUIObject_SoftKeys_SetActionAndText( f_list_gui, ACTION_SELECT1, Self_onEnterPressed, OPEN_TXT );
   \   00000078   0E49               LDR      R1,??CreateFileFolderSelect_5+0x8  ;; 0xfc2
   \   0000007A   0F4B               LDR      R3,??CreateFileFolderSelect_5+0xC  ;; 0x531
   \   0000007C   0F4A               LDR      R2,??CreateFileFolderSelect_5+0x10  ;; ??Self_onEnterPressed
   \   0000007E   2000               MOVS     R0,R4
   \   00000080   ........           _BLF     GUIObject_SoftKeys_SetActionAndText,??GUIObject_SoftKeys_SetActionAndText??rT
    310            GUIObject_SoftKeys_SetActionAndText( f_list_gui, 1, Self_onSelectPressed, SELECT_TXT );
   \   00000084   0E4B               LDR      R3,??CreateFileFolderSelect_5+0x14  ;; 0xb5c
   \   00000086   0F4A               LDR      R2,??CreateFileFolderSelect_5+0x18  ;; ??Self_onSelectPressed
   \   00000088   0121               MOVS     R1,#+1
   \   0000008A   2000               MOVS     R0,R4
   \   0000008C   ........           _BLF     GUIObject_SoftKeys_SetActionAndText,??GUIObject_SoftKeys_SetActionAndText??rT
    311            GUIObject_SoftKeys_SetAction( f_list_gui, ACTION_BACK, Self_OnBack );
   \   00000090   0D4A               LDR      R2,??CreateFileFolderSelect_5+0x1C  ;; ??Self_OnBack
   \   00000092   FC21               MOVS     R1,#+252
   \   00000094   0901               LSLS     R1,R1,#+4
   \   00000096   2000               MOVS     R0,R4
   \   00000098   ........           _BLF     GUIObject_SoftKeys_SetAction,??GUIObject_SoftKeys_SetAction??rT
    312            GUIObject_Show( f_list_gui );
   \   0000009C   2000               MOVS     R0,R4
   \   0000009E   ........           _BLF     GUIObject_Show,??GUIObject_Show??rT
    313            
    314            StringFree( ustr );
   \   000000A2   2800               MOVS     R0,R5
   \   000000A4   ........           _BLF     ??StringFree,??StringFree??rT
    315            return f_list_gui;
   \   000000A8   2000               MOVS     R0,R4
   \   000000AA   F0BD               POP      {R4-R7,PC}       ;; return
   \                     ??CreateFileFolderSelect_5:
   \   000000AC   2F000000           DC8      0x2F, 0x00, 0x00, 0x00
   \   000000B0   ........           DC32     ??OnMessage
   \   000000B4   C20F0000           DC32     0xfc2
   \   000000B8   31050000           DC32     0x531
   \   000000BC   ........           DC32     ??Self_onEnterPressed
   \   000000C0   5C0B0000           DC32     0xb5c
   \   000000C4   ........           DC32     ??Self_onSelectPressed
   \   000000C8   ........           DC32     ??Self_OnBack
    316          }

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable2:
   \   00000000   ........           DC32     `?<Constant "FList">`

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable4:
   \   00000000   ........           DC32     `?<Constant L"\\x2f\\x25\\x6c\\x73">` + 12

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "FList">`:
   \   00000000   464C69737400       DC8 "FList"
   \   00000006   0000               DC8 0, 0

   \                                 In segment DATA_C, align 4, align-sorted
   \   00000000   2F000000           DC8 2FH, 0, 0, 0
    317          

   Maximum stack usage in bytes:

     Function                       CSTACK
     --------                       ------
     AddToFList(wchar_t const *, wchar_t const *, int)
                                       24
     CreateFData()                      8
     CreateFileFolderSelect(BOOK *, wchar_t *)
                                       20
     DeleteFData()                      8
     FindFLISTtByN(int)                 8
     FindFLISTtByNS(int *, int)        12
     FindFiles(wchar_t *, int)         80
     Free_FLIST()                      16
     GetFData()                         4
     OnMessage(GUI_MESSAGE *)          12
     Self_OnBack(BOOK *, GUI *)         8
     Self_onEnterPressed(BOOK *, GUI *)
                                       20
     Self_onSelectPressed(BOOK *, GUI *)
                                       12
     isdir(wchar_t *)                  44


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     ?<Constant L"\x2f\x25\x6c\x73">
                                      20
     CreateFData()                    32
     GetFData()                       20
     DeleteFData()                    32
     Free_FLIST()                     46
     AddToFList(wchar_t const *, wchar_t const *, int)
                                     102
     FindFiles(wchar_t *, int)       236
     FindFLISTtByNS(int *, int)       36
     FindFLISTtByN(int)               50
     OnMessage(GUI_MESSAGE *)         70
     Self_OnBack(BOOK *, GUI *)       28
     Self_onEnterPressed(BOOK *, GUI *)
                                     128
     Self_onSelectPressed(BOOK *, GUI *)
                                      86
     isdir(wchar_t *)                 34
     CreateFileFolderSelect(BOOK *, wchar_t *)
                                     204
     ??DataTable2                      4
     ??DataTable4                      4
     ?<Constant "FList">               8
     ?<Constant L"\x2f">               4
      Others                         416

 
 1 528 bytes in segment CODE
    32 bytes in segment DATA_C
 
 1 112 bytes of CODE  memory (+ 416 bytes shared)
    32 bytes of CONST memory

Errors: none
Warnings: none
